# frozen_string_literal: true

source 'https://rubygems.org'

# KairosChain MCP Server
#
# By default, KairosChain requires no external gems (Ruby standard library only).
# The gems below are OPTIONAL and enable additional features.
#
# To install optional dependencies:
#   bundle install
#
# Or install individually:
#   gem install hnswlib informers

# =============================================================================
# Optional: RAG (Semantic Search) Support
# =============================================================================
#
# These gems enable semantic/vector search for skills and knowledge.
# Without these gems, KairosChain falls back to regex-based search.
#
# Requirements:
#   - C++ compiler (for native extensions)
#   - ~90MB disk space for embedding model (downloaded on first use)
#
# Installation:
#   bundle install --with rag
#   # or
#   gem install hnswlib informers
#

group :rag, optional: true do
  # HNSW (Hierarchical Navigable Small World) for fast approximate nearest neighbor search
  # https://github.com/yoshoku/hnswlib.rb
  gem 'hnswlib', '~> 0.9'

  # ONNX-based sentence embeddings (sentence-transformers compatible)
  # https://github.com/ankane/informers
  gem 'informers', '~> 1.0'
end

# =============================================================================
# Optional: SQLite Storage Backend (Team Use)
# =============================================================================
#
# Enables SQLite-based storage for team environments with concurrent access.
# Without this gem, KairosChain uses file-based storage (default).
#
# Features:
#   - ACID transactions for data integrity
#   - Built-in locking for concurrent access
#   - WAL mode for better read/write concurrency
#
# Installation:
#   bundle install --with sqlite
#   # or
#   gem install sqlite3
#
# Configuration (in skills/config.yml):
#   storage:
#     backend: sqlite
#     sqlite:
#       path: "storage/kairos.db"
#       wal_mode: true
#

group :sqlite, optional: true do
  # SQLite3 Ruby bindings
  # https://github.com/sparklemotion/sqlite3-ruby
  gem 'sqlite3', '~> 1.6'
end

# =============================================================================
# Optional: Streamable HTTP Transport (Remote/Team Access)
# =============================================================================
#
# Enables Streamable HTTP transport for remote MCP connections.
# Without these gems, KairosChain uses stdio transport only (local).
#
# Features:
#   - Remote MCP access via HTTP POST /mcp
#   - Bearer token authentication
#   - Team sharing of a single KairosChain instance
#   - Recommended with SQLite backend for concurrent access
#
# Installation:
#   bundle install --with http
#   # or for full team setup:
#   bundle install --with http sqlite
#
# Usage:
#   ruby bin/kairos_mcp_server --http --port 8080
#   ruby bin/kairos_mcp_server --init-admin  # Generate initial admin token
#
# For production HTTPS, use Caddy as reverse proxy:
#   kairos.example.com { reverse_proxy localhost:8080 }
#

group :http, optional: true do
  # Puma: Fast, concurrent web server for Ruby
  # https://github.com/puma/puma
  gem 'puma', '~> 6.0'

  # Rack: Modular Ruby web server interface
  # https://github.com/rack/rack
  gem 'rack', '~> 3.0'
end

# =============================================================================
# Development Dependencies
# =============================================================================

group :development, :test do
  # Testing
  gem 'minitest', '~> 5.0'
  gem 'rake', '~> 13.0'
end
