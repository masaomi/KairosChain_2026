# KairosChain Meeting Protocol Configuration
# This file configures how this KairosChain instance presents itself
# and interacts with other KairosChain instances.

# Master switch for Meeting Protocol (MMP) features
# - false (default): Meeting Protocol is disabled, no meeting code is loaded
# - true: Meeting Protocol is enabled
# 
# When disabled:
# - No meeting-related require statements are executed (reduces memory footprint)
# - meeting/* methods return "Meeting Protocol disabled" error
# - No Meeting Place connections can be made
# - HTTP server for Meeting Protocol is not started
#
# Set to true only if you need inter-agent communication features.
enabled: false

# Identity: How this instance introduces itself
identity:
  name: "KairosChain Instance"
  description: "A memory-capable, evolvable agent framework"
  # Scope describes the domain expertise (e.g., "bioinformatics", "web-development", "general")
  scope: "general"
  # Fixed agent ID for consistent identity across connections (recommended)
  # If not set, a new random ID is generated each time you connect
  # Example: agent_id: "my-unique-agent-001"
  # agent_id: null

# Capabilities: What this instance can do in the Meeting Protocol
capabilities:
  meeting_protocol_version: "1.0.0"
  supported_actions:
    - introduce
    - offer_skill
    - request_skill
    - accept
    - decline
    - reflect

# Skill Exchange: Rules for sharing skills with other instances
skill_exchange:
  # Allowed formats for skill exchange (safety-first approach)
  # - markdown: Safe, human-readable documentation
  # - yaml_frontmatter: Metadata in YAML format at the top of markdown
  allowed_formats:
    - markdown
    - yaml_frontmatter
  
  # SECURITY: Allow executable code exchange (Ruby DSL/AST)
  # WARNING: Set to true only if you trust ALL peers you connect with
  # Default: false (recommended for safety)
  allow_executable: false
  
  # Whether skills are public by default
  # If false, skills need explicit `public: true` in frontmatter to be shared
  public_by_default: false
  
  # Filter which skills to expose (glob patterns)
  # Empty list means all skills in knowledge/ are candidates
  include_patterns: []
  
  # Exclude specific skills from sharing
  exclude_patterns:
    - "**/private/**"
    - "**/.git/**"

# Constraints: Limits and safety boundaries
constraints:
  # Maximum size of a skill file in bytes
  max_skill_size_bytes: 100000
  
  # Rate limiting for incoming requests (per minute)
  rate_limit_per_minute: 10
  
  # Maximum number of skills to return in a list
  max_skills_in_list: 50

# HTTP Server (for Meeting Protocol API)
# This enables HTTP-based communication between KairosChain instances
http_server:
  enabled: true
  host: "127.0.0.1"
  port: 8080
  # Timeout for HTTP requests (seconds)
  timeout: 10
  # For SSH tunneling, keep host as localhost
  # Access via: ssh -L 9999:localhost:8080 user@remote

# Peer Management
peers:
  # Auto-reconnect to known peers on startup
  auto_reconnect: false
  # Save peer list to file
  persist_peers: false
  # peers_file: "storage/peers.json"

# E2E Encryption (Phase 4.5)
# All messages exchanged via Meeting Place are encrypted end-to-end.
# The Meeting Place server CANNOT read message content.
encryption:
  # Enable E2E encryption for message relay
  enabled: true
  
  # Encryption algorithm (RSA for key exchange, AES for messages)
  algorithm: "RSA-2048+AES-256-GCM"
  
  # Path to save/load keypair (relative to workspace)
  keypair_path: "config/meeting_keypair.pem"
  
  # Auto-generate keypair if not found
  auto_generate: true

# Meeting Place Client (when connecting to a Meeting Place server)
meeting_place:
  # Connection mode: "off" | "manual" | "auto"
  # - off: Meeting Place features completely disabled
  # - manual: Connect only when user explicitly requests (RECOMMENDED)
  # - auto: Auto-connect on startup (NOT RECOMMENDED - may incur costs)
  connection_mode: "manual"
  
  # Default Meeting Place URL (can be overridden at runtime)
  # Leave commented out or null to require explicit URL on connect
  # url: "http://localhost:8888"
  
  # Require user confirmation before connecting (for CLI)
  confirm_before_connect: true
  
  # Maximum session duration in minutes (0 = unlimited, not recommended)
  # After this time, connection will be automatically closed with warning
  max_session_minutes: 60
  
  # Warning after N interactions (to prevent runaway token usage)
  # Set to 0 to disable
  warn_after_interactions: 50
  
  # Auto-register public key when connecting
  auto_register_key: true
  
  # Cache peer public keys locally
  cache_keys: true

# Protocol Evolution (Phase 7)
# Controls how this instance handles protocol extension sharing and adoption.
protocol_evolution:
  # Automatically evaluate proposed extensions from peers
  auto_evaluate: true
  
  # Days to keep extension in L2 (experimental) before promotion eligible
  evaluation_period_days: 7
  
  # Allow automatic promotion to L1 (NOT RECOMMENDED)
  # If false, all promotions require human approval
  auto_promote: false
  
  # Require human approval for L1 promotion
  require_human_approval_for_l1: true
  
  # Actions that are NEVER allowed in extensions
  # Extensions containing these actions will be rejected
  blocked_actions:
    - execute_code
    - system_command
    - file_write
    - shell_exec
    - eval
    - require
    - load
  
  # Maximum number of actions per extension
  max_actions_per_extension: 20
  
  # Auto-share adopted extensions with peers
  # If true, extensions you've promoted to L1 will be offered to peers
  auto_share_extensions: false
  
  # Trust level for automatic adoption
  # - none: Never auto-adopt (always require evaluation)
  # - known: Auto-adopt from previously trusted peers
  # - all: Auto-adopt from any peer (NOT RECOMMENDED)
  auto_adopt_trust_level: "none"
